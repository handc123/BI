<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zjrcu.iras.bi.globaloverview.mapper.NonPerformingMonitoring.NonPerformingLoanMapper">
    <resultMap id="NonPerformingLoanResult" type="com.zjrcu.iras.bi.globaloverview.domain.model.NonPerformingMonitoring.NonPerformingLoan">
        <result property="dataDate" column="data_date"/>
        <result property="nonPerformingLoanRatio" column="non_performing_loan_ratio"/>
        <result property="concernNonPerformingLoanRatio" column="concern_non_performing_loan_ratio"/>
        <result property="overdue90daysLoanRatio" column="overdue_90days_loan_ratio"/>
        <result property="regionName" column="region_name"/>
        <result property="id" column="id"/>
        <result property="createTime" column="created_time"/>
        <result property="updateTime" column="updated_time"/>
    </resultMap>

    <select id="selectNonPerformingLoanRate" resultType="java.math.BigDecimal">
        SELECT
        non_performing_loan_ratio
        FROM
        non_performing_loan_data
        where
            data_date = #{globalOverviewRequestQO.dataDate}
            AND region_name = #{globalOverviewRequestQO.regionName}
    </select>
    <resultMap id="LoanTrendResultMap" type="com.zjrcu.iras.bi.globaloverview.domain.vo.NonPerformingMonitoring.NonPerformingLoanTrendVo">
        <result property="dataDate" column="data_date"/>
        <result property="overdue90daysLoanRatio" column="overdue_90days_loan_ratio"/>
        <result property="concernNonPerformingLoanRatio" column="concern_non_performing_loan_ratio"/>
    </resultMap>

    <select id="selectNonPerformingLoanRateMonth" resultMap="LoanTrendResultMap">
        select data_date,
               concern_non_performing_loan_ratio,
               overdue_90days_loan_ratio
        from non_performing_loan_data

        <where>
            region_name = #{globalOverviewRequestQO.regionName}
            <if test="globalOverviewRequestQO.startDate != null and globalOverviewRequestQO.startDate!= ''">
                AND data_date >= #{globalOverviewRequestQO.startDate}
            </if>
            <if test="globalOverviewRequestQO.endDate != null and globalOverviewRequestQO.endDate!= ''">
                AND data_date &lt;= #{globalOverviewRequestQO.endDate}
            </if>
        </where>
        order by data_date  asc
    </select>
    <select id="selectRegionByOrgName" resultType="java.lang.String">
        select region_name
        from org_region
        where org_name = #{orgName}
    </select>

</mapper>